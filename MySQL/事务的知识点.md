# 什么是事务
**简单来说就是一组不可分割的操作，要么全部执行成功，要么全部执行失败**
# 事务的特点 （ACID模型）
1. **原子性（Atomicity）**：事务中的所有操作是一个不可分割的整体，要么全做，要么全不做。就像上面的转账，不可能只扣钱不打钱。
2. **一致性（Consistency）**：事务执行前后，数据的完整性约束（比如账户余额不能为负）必须保持一致。比如转账前两个账户总余额是 2000 元，转账后总余额也必须是 2000 元。
3. **隔离性（Isolation）**：多个事务同时执行时，它们之间相互隔离，不会互相干扰。比如你转账的同时，另一个人给你转钱，两个事务的操作不会互相影响。
4. **持久性（Durability）**：事务一旦执行成功，它对数据的修改就是永久性的，即使后续系统崩溃，数据也不会丢失。
# mysql如何实现事务
1. 隔离性： 利用**锁**的机制来控制数据并发修改
2. 持久性：**利用Redo Log （重做日志）**，其实就是一个记录事务修改mysql的操作的文件，如果数据库发生宕机等事故，可以重放 Redo Log来恢复数据
3. 原子性：利用**Undo Log（回滚日记）** 其实就一个记录事务的反向操作的文件，一单事务执行失败，就读取它进行回滚
4. MVCC：多版本并发控制，实现了读已提交和重复读两种隔离级别，实现了事务的隔离性
# mysql事务的二阶端提交
事务二阶段提交只要是解决**crash recovery（崩溃恢复）** 的一种机制，不会出现**数据丢失**和数据不一致的情况
## 具体的实现流程
* 准备阶段：InnoDB 引擎先写入Rodo log 文件上，并且把它的状态标志为**prepare** 
* 提交阶段：MySQL Server 层会写入Binlog 文件，当Binlog文件写入完成，就会通知InnoB引擎把Rodo的状态改为**commit** ，实现事务的完整提交
## 崩溃恢复的实现
这两个字段都有一个共同的字段XID，当出现崩溃的情况，恢复后的mysql先查Rodo Log 文件的状态是否是**pepare** ，如果是则取它的XID接着去Binlog文件查找相同的XID字段，存在则说明事务提交成功
## 组提交优化
* redo Log组提交 （多个Bin Log文件先提交到缓存区 ，最后再一起提交redo log文件）
* Bin Log组提交（等待多个Bin Log文件在进行提交）
# 隔离级别
